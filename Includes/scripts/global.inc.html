<script>
  document.addEventListener('DOMContentLoaded', pageLoaded);

  function pageLoaded() {
    let evtId = document.getElementById('btnSave').dataset.id;
    let evtName = document.getElementById('btnSave').dataset.name;
    google.script.run.withSuccessHandler(setCopyrightYear).getCurrentYear();
    google.script.run.withSuccessHandler(setMaxEntries).getMaxEntriesPerShow(evtId);
    google.script.run.withSuccessHandler(setMaxPerArtist).getMaxEntriesPerArtist(evtId);
    google.script.run.withSuccessHandler(setEntriesSubmitted).getTotalByEvent(evtName);
    document.getElementById('emailAddress').addEventListener('change', checkMemberEmail);
    document.getElementById('imageFile').addEventListener("change", showThumbnail);
  }

  function setCopyrightYear(yr) {
    document.getElementById("copyrightYear").innerHTML = `Copyright &copy; ${yr}`;
  }

  function setMaxEntries(max) {
    if (max===0) {
      document.getElementById("maxEntries").innerText = "Unknown";
    } else {
      document.getElementById("maxEntries").innerText = max;      
    }

  }

  function setMaxPerArtist(max) {
    if (max === 0) {
      document.getElementById("maxPerArtist").innerText = "Unknown";
    } else {
      document.getElementById("maxPerArtist").innerText = max;
    }
  }

  function setEntriesSubmitted(count) {
    document.getElementById("entriesSubmitted").innerText = count;
  }

  function showMemberFirstName(name) {
    document.getElementById("firstName").value = name;
  }

  function showMemberLastName(name) {
    document.getElementById("lastName").value = name;
  }

  function showMemberPhone(phoneNumber) {
    document.getElementById("phoneNumber").value = phoneNumber;
  }

  function checkMemberEmail(el) {
    let email = this.value;
    let evtName = document.getElementById('btnSave').dataset.name;
    google.script.run.withSuccessHandler(showMemberSuccess).isMember(email.toLowerCase());
    google.script.run.withSuccessHandler(showMemberFirstName).getMemberFirstName(email);
    google.script.run.withSuccessHandler(showMemberLastName).getMemberLastName(email);
    google.script.run.withSuccessHandler(showMemberPhone).getMemberPhone(email);
    google.script.run.withSuccessHandler(setSubmitsByArtist).getTotalByEventArtist(evtName, email)
  }
</script>